{{/* Build-time filtering for upcoming events */}}
{{ $now := now.Format "2006-01-02" }}
{{ $candidates := where .Pages ".Params.active" "!=" false }}

{{ $upcoming := slice }}
{{ range $candidates }}
  {{ $event := . }}
  {{ $end := .Params.end | default .Params.start }}
  {{ with $end }}
    {{ $endStr := dateFormat "2006-01-02" . }}
    {{ if ge $endStr $now }}
      {{ $upcoming = $upcoming | append $event }}
    {{ end }}
  {{ end }}
{{ end }}

{{ $sorted := sort $upcoming ".Params.start" }}

<ul class="events">
  {{ range $sorted }}
    <li class="event-item">
      <a href="{{ .RelPermalink }}">{{ .Title }}</a>
      {{ with .Params.start }} <time datetime="{{ . }}">{{ . }}</time>{{ end }}
      {{ with .Params.end }} – <time datetime="{{ . }}">{{ . }}</time>{{ end }}
      {{ with .Params.location }} — {{ . }}{{ end }}
    </li>
  {{ else }}
    <li>No upcoming events.</li>
  {{ end }}
</ul>